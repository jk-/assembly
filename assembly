Assembly Language:
For x86 Processors Sixth Edition

Kip R. Irvine

Chapter 1: Basic Concepts

MSB and LSB

Most significant bit
and Least significant bit

Most is on the left
Least is on the right

Integer Storage Types

byte        8-bits
word        16-bits
doubleword  32-bits
quadword    64-bits

A "word" is not "a word"

Unsigned Ranges:

byte        0-255
word        0-65535
doubleword  0-4294967295
quadword    0-18446744073709551615

Signed:
The MSB is the sign bit which tells us if the number is positive or negative.
0: positive
1: negative

Ranges:
byte        -128 to 127
word        -32768 to 32767
doubleword  -214744836448 to 2 billion
quadword    blah

Two's Complement Notation:
Trying to tell us that everything can be done by addition.

Steps:
Flip-bits (1's comp)
Add 1

1.4 Boolean Operations

NOT: ¬
AND: ∧
OR: ∨

"Order of operations":
NOT is first before parentheses

2.0 General Concepts

2.1.1 Basic Microcomputer Design

Contains:
Registers are contained in the CPU (limited number)

A high-frequency clock
A control unit
And an arithmetic logic unit

Clock: synchronizes the internal operations of the CPU with other system components.

Control Unit (CU): coordinates the sequence of steps involved in executing machine instructions.

Arithemtic logic unit (ALU): performs arithmetic operations.

CPU pins connect to the data bus, the control bus and the address bus.

The Memory Storage Unit (MSU) is where instructions and data are held while the computer program is running.

All processing of data takes place in the CPU. Programs residing in memory must be copied into the CPU before they can excute.

Bus: is a group of parallel wires that transfer data from one part of the computer to another.

There are usually four bus types:
Data
I/O
Control
Address


Data bus transfers instructions between the CPU and memory.

The I/O bus transfer bus data between the CPU and system inputs.

The control bus uses binary signals to sync actions of all devices attached to the system bus.

The address bus holds the addresses of instructions and data when the currently execting instruction transfer data between the CPU and memory.

CLOCK
Pulses at a constant rate. The basic unit of time is a "Machine Cycle" or "Clock Cycle". The length of the clock cycle is the time required for one compelte clock pulse.

A clock cycle is the time between one falling cycle and the next. (lambda in math λ).

The duration of a clock cycle is calc as the reciprocal of the clocks speed, which in turn measures in oscillations per second.

1 Billion times per second: 1GHz.

A machine cycle requires at leastt 1 clock cycle to execute and a few require in excess of 50 clocks).

Instructions requiring memory access often have empty clock cycles called wait states because of the differences in the speeds of the CPU, the system bus and memory circuits.


2.1.2 Instruction Execution Cycle

The execution of a single machine instruction can be divided into a sequence of individual operations called INSTRUCTION EXECUTION CYCLES.

Before executing a program is copied into memory.

The INSTRUCTION POINTER contains the address of the next instructions.

The INSTRUCTION QUEUE holds a group of instructions about to be executed.

Three basic types:
Fetch
Decode
Execute

When using memory, two more steps are required:
Fetch Operand
Store output operand

Fetch: The control unit (CU) fetches the next instruction from the queue and increments the pointer. Also called a program counter.

Decode: The control unit decodes the instructions function to determine what the instruction will do. The instructions input operands are passed to the ALU, and singals are sent to the ALU indicating the operation tobe performed.

Fetch Operand: If the instruction uses an input operand located in memory, the control unit uses a READ operation to retrive the operand and copy it into internal registers. Internal registers are not visible to programs.

Execute: The ALU executes the instructions using the named registers and internal registers as operands and sends the output to named reggisters and or memory. The ALU updates status flags providing inofmration about the processor state.
Store Output operand: If the output operand is in memory, the control unit uses a write operation to store the data.

loop
    fetch next instruction
    advanced the instruction pointer (IP)
    if memory needed, val memory
    execute instruction
    if result is memory, write resultt
continue loop

In order to read instructiosn from memory, an address is palced on the address bus.
next, The memory controller places the req  uested code on the data bus, making the code avail inside the code cache.
Instruction Pointer (IP) determines which instruction will be executed next.

2.1.3 Reading from Memory

Program throughput is often dependent on speed of memory access. CPU clock speed might be several gigahertz, whereas access to memory occurs over a system bus running at a much slower speed.

The CPU must wait one or more clock cycles until operands have been fetched from memory before the current instruction can complete its execution. The wasted clock cycles are called wait states.

Trailing Edges: A clock-cycle begins as the clock signal changes from high to low.

Conventional memory is slower than the CPU, computers use high-speech cache memory to hold the most recently used instructions and data. The first time a program reads a block of data, it leaves a copy in the cache. (L2/L3 Cache)


2.1.4 How Programs Run

Load and Execute Process

Command promtp program:
1. The OS searches for the programs filename in the current disk directory. if the file is not found it looks in the $PATH
2. Found: the OS retrieves basic information about the programs file.
3. OS determines the next available locattion in memory and loads the program file into emmory. itt allocates a block of memory to the program and enters information about the programs size and location intoa table called a DESCRIPTOR TABLE. The OS may adjust the values of pointers within the progam so they contain addresses of the program data.
4. OS begins execution of the progams first machine instruction. As soon as the program begin running it is called a process. The OS assigns the process an ID number (process ID).
5. Process runs by itself. It is the OS's job to track the execution of the process to respond to request from system resources.

Multitasking
A CPU can really execute only one instruction at a time, so a component of the operating system named the scheduler allocates a slice of CPU time (called a TIME SLICE) to each task. During a single titme slice, the CPU executes a block of isntructions, stopping when the time slice has ended.

Scheduling:
Round-Robin

The processor saves the state of each task before switching to a new one. A task's state consists of the contents of the procssor registers, program counter and status flags, along with references to the tasks memory segment.

2.2.1 Models of Operation

Three primary modes of operation:
Protected, real-addres mode and system management mode.

Protected Mode: Protected mode is the native state of the processor, in which all instructions and features are available. Programs are given seperate memory areas named segments, and the procesor prevents progams from referencing memory outside their assigned segments.

Virtual-8086 mode: While in protected mode, the processor can directly execute real-address mode software such as MS-DOS programs in a safe multitasking env.

real-Address mode: real-addres mode implements the programming environment of the processor with a few extra features, such as the abbility to switch into other modes. Progams running in real address mode can cause the OS to crash.

Systetm management mode: SMM provides OS with the mechanism for implementing functions such as power management and sytstem security.


2.2.2 Basic Execution Environment

Address Space
in 32-bit protected mode, a task or program can address a linear addres space of up to 4GBs. A technique called Extended Physical Addressing allows a total of 64 gigs of physical memory to be address. Real address mode can only address a range of 1 MByte.

Basic Program Execution Registers:

Registers are high-speed storage locations directly inside the CPU, designed to be accessed at much higher speeds than conventional memory. When a processing loop is optimized for speed, for example, loop counters are held in registers rather than variables.

Eight General Purpose Registers
Six Segment Registers
Processor Status Flags Register (EFFLAGS)
Instruction pointer (EIP)

32-Bit General-Purpose Registers
EAX         EBP
EBX         ESP
ECX         ESI
EDX         EDI

EFLAGS
EIP

16-bit Registers
CS      ES
SS      FS
DS      GS

General Purpose Registers (GPR's) are primarly used for arithemtic and data movement.

Portions of some registers can be addrsesed as 8-bit values.

32-BIT  16-BIT  8Bit High (H)   8Bit Low (L)
EAX     AX      AH              AL


Specialized uses:
EAX: is automatically used by multiplication and division instructions. Extended Accumulator Register
ECX: Loop Counter
ESI and EDI: used by high-speed memory transfer instructions. Extended Source Index and Extended Desitiontion Indxes.
EBP: used by high-level languages to reference function parameters and local variables on the stack. Extended Frame Pointer.

Segment Registers:
In real-address mode, 16-bit segment registers indicate base addresses of preassigned memory areas named segments. In protected mode, segment registers hold pointers to segment descfiptor tables. Some segments hold progarm instructions (code), others hold variables (data) and another segment named the STACK SEGMENT holds local function variables and function aprameters.

EIP (extended Instruction pointer): contains the address of the next instruction to be executed. Certain machine instructions manipulate the EIP, causing the program to branch to a new location.

EFLAGS register (FlAGS): consists of indivual binary bits that control the operation of the CPU or reflect the outcome of some CPU operation. Some instructions test and manipulate individual processor flags.

Control Flags: Control the CPUs operation. Can cause the CPU to break after every instruction executes, interrupt when arithmetic overflow is detected, enter virtual-8086 mode, and enter procted mode.

Direction and Interrupt Flags and be set in the EFLAGS.

Status Flags:
Overflow
Sign
Zero
Auxiliary Carry
Parity
Carry Flags

Carry Flag (CF): is set when the result of an unsigned arithemtic operation is too large to fit into the destination.

Overflow (OF) is set when the result of the signed arithmetic operation is too large or too small to fit into the destination.

Sign (SF) is set when the result of an arithmetic or logical operation generates a negative result.

Zero (ZF) is set when the result of the arithmetic or logical operation generates a result of zero.

Auxiliary Carry (AC) is set when an arithmetic operation causes a carry from bit 3 to bit 4 in an 8-bit operand.

Parity (PF) is set if the least -significant byte is the resul contains an even number of 1 bits. Otherswise, PF is clear. In general, it is used for error checking when there is a possibility tat data might be altered or corrupted. Used as a voltage checksum.

MMX Registers
Eight 64-bit MMX registers support special instructions called SIMD (Single-instruction, Multiple-Data)
MMX register names are in fact aliases to the same registers used by the floating-point unit.

2.2.3 Floating-Point Unit
FPU performs high-speed floating-point arithmetic. At one point a seperate coprocessor chip was required for this. now it has been integrated into the main processor chip.

Eight Floating-Point Data Registers:
ST(0)
ST(1)
...
ST(7)
